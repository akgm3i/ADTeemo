# プロジェクト名

このプロジェクトはDiscordボットと、それに付随するAPIで構成されています。

## 環境構築

このプロジェクトはDockerとDenoを使用します。お使いの環境にDockerがインストールされていることを確認してください。

### 環境変数ファイル

作業を始める前に、2つの環境変数ファイルを作成する必要があります。

-   `.env`: 本番環境用
-   `.env.dev`: 開発環境用

両方のファイルは、`.env.example`ファイルをテンプレートとして使用できます。

## 本番環境 (Production)

本番環境は、最適化されたコンテナを実行するように構成されています。

**本番環境のサービスをビルドして起動するには:**

```bash
docker compose --profile prod up -d --build
```

サービスはデタッチモードで起動します。ログを確認するには `docker compose logs -f` を使用してください。

**サービスを停止するには:**

```bash
docker compose --profile prod down
```

## 開発環境 (Development)

開発環境は、ホットリロードと対話的なアクセスを伴うローカル開発用に設計されています。

**開発環境のサービスをビルドして起動するには:**

```bash
docker compose --profile dev up -d --build
```

これにより`dev`サービスが起動します。コンテナは実行状態になりますが、Denoアプリケーションは自動的には開始されません。

**対話的なシェルを開くには:**

実行中のサービスコンテナ内でシェルを開き、コマンドを実行することができます。

```bash
docker compose exec dev bash
```

**シェル内では、様々なタスクを実行できます。例:**

ホットリロードを有効にした開発サーバーを起動する:
```bash
deno task dev:all
```

すべてのテストを実行する:
```bash
deno task test:all
```

データベースの変更を反映する:
```bash
deno task db:push
```

## データベース管理

本番環境のデータベースをバックアップし、それをローカルの開発環境にリストアしてテストすることが可能です。

**1. 本番データベースのバックアップ:**

このコマンドは、本番環境のDockerボリュームからデータベースを `./db-backup/sqlite.backup.db` というローカルファイルにコピーします。

```bash
deno task db:backup
```

**2. ローカル開発データベースへのリストア:**

このコマンドは、バックアップファイルをローカルの`./data`ディレクトリにコピーします。このディレクトリは開発環境で使用されます。

```bash
deno task db:restore-local
```
